<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}PROVISP Hackathon{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'fontawesome-free-7.1.0-web/fontawesome-free-7.1.0-web/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">


    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêë</text></svg>">
</head>
<body class="bg-light text-dark">

    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm py-2">
      <div class="container d-flex align-items-center">
        <a class="navbar-brand d-flex align-items-center" href="/">
          <img src="{% static 'images/PROVISP_Lab1.png' %}"
               alt="PROVISP Lab Logo"
               class="me-2"
               style="height:48px; width:auto;">
          <span class="fw-bold fs-4 text-white">PROVISP</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a href="/about" class="nav-link">About</a></li>
            <li class="nav-item"><a href="/contact" class="nav-link">Contact</a></li>
            <li class="nav-item">
              <a href="https://login.gsis.gr/mylogin/login.jsp"
                 class="btn btn-outline-light ms-3"
                 target="_blank"
                 rel="noopener noreferrer">
                 Login via Taxisnet
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Fake notification -->
    <div id="fake-alert" class="alert alert-danger text-center m-0" role="alert" style="display:none;">
      ‚ö†Ô∏è Sheep <strong>ŒúŒøœÖœÉœáŒøœçœÅŒ∑</strong> (ID: 6) has been diagnosed with <strong>Sheeppox</strong>. Please contact the company to withdraw the product.
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const alertBox = document.getElementById("fake-alert");
      // Show after 3 seconds
      setTimeout(() => alertBox.style.display = "block", 500);
      // Hide after 10 seconds
      setTimeout(() => alertBox.style.display = "none", 10000000);
    });
    </script>
    <main class="container py-5">
        <div class="bg-white p-5 rounded-4 shadow-sm">
        {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="footer mt-auto py-3 bg-light border-top">
      <div class="container text-center d-flex flex-column align-items-center">
        <small class="text-muted">¬© 2025 PROVISP Hackathon ‚Äî PROVISP Vision & Signal Processing Laboratory</small>
      </div>
    </footer>


    <!-- Chat Widget -->
    <div id="chat-widget">
        <button id="chat-toggle" class="btn btn-success rounded-circle" style="width: 56px; height: 56px;">
            <i class="fas fa-comment"></i>
        </button>
    </div>

    <div id="chat-window" class="d-flex flex-column bg-white border rounded shadow" hidden
         style="width: 400px; height: 500px; position: fixed; bottom: 80px; right: 20px; z-index: 9999;">
        <div class="bg-success text-white p-2 d-flex justify-content-between align-items-center rounded-top">
            <span class="fw-bold">Ask PROVISP AI</span>
            <button id="chat-close" class="btn btn-sm btn-light p-1" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div id="chat-messages" class="flex-grow-1 p-2 overflow-auto bg-light" style="min-height: 300px;"></div>
        <div class="p-2 border-top d-flex gap-2">
            <input type="text" id="chat-input" class="form-control form-control-sm" placeholder="Ask about a compound...">
            <button id="chat-send" class="btn btn-success btn-sm">Send</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatToggle = document.getElementById('chat-toggle');
        const chatClose = document.getElementById('chat-close');
        const chatWindow = document.getElementById('chat-window');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');

        // Toggle chat window using hidden attribute
        chatToggle.addEventListener('click', function() {
            chatWindow.hidden = false;
            chatToggle.style.display = 'none';
            chatInput.focus();
        });

        // Close chat window
        chatClose.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            chatWindow.hidden = true;
            chatToggle.style.display = 'inline-block';
        });

        // Add message to chat
        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `chat-message ${role} mb-1`;
            div.innerHTML = `<div class="p-2 rounded ${role==='user'?'bg-primary text-white':'bg-light text-dark'}">${text}</div>`;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send message function
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            chatInput.value = '';

            try {
                const resp = await fetch(`/qa?q=${encodeURIComponent(message)}`);
                const data = await resp.json();
                addMessage('assistant', data.answer || 'I do not have enough information.');
            } catch (err) {
                console.error('Chat error:', err);
                addMessage('assistant', 'Error contacting server.');
            }
        }

        // Event listeners for sending
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
            if(e.key === 'Enter') sendMessage();
        });
    });
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>